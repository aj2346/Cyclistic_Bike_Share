 *Data Source*:
  ## Link to Datasets=
  [https://divvy-tripdata.s3.amazonaws.com/index.html]
  *(Note: The datasets have a different name because Cyclistic is a fictional company. For the purposes of this case study,
    the datasets are appropriate and will enable you to answer the business questions. The data has been made available by
    Motivate International Inc. under this license)*

## **Process**:
*  *Data Import*
    *12 zip files downloaded to computer*:

    *from*: [https://divvy-tripdata.s3.amazonaws.com/index.html]
        (link to datasets)

* *12 files opened and save in csv format to desktop*:
   Capstone_Project_Data_Analytics
  
* *12 files imported to RStudio*

## **Set up environment in RStudio**

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
``` 
```{r, install packages and load libraries}
install.packages("tidyverse")
library("tidyverse")
install.packages("janitor")
library("janitor")
install.packages("lubridate")
library("lubridate")
install.packages("scales")
library("scales")
install.packages("ggmap")
library("ggmap")
install.packages("data.table")
library("data.table")
install.packages("ggplot2")
library("ggplot2")
install.packages("esquisse")
library("esquisse")
install.packages("magrittr")
library(magrittr)
install.packages("forecast")
library("forecast")
install.packages("mapproj")
library("mapproj")
install.packages("devtools")
library("devtools")
install.packages("extrafont")
library("extrafont")
install.packages("ggthemes")
library("ggthemes")
```

```{r, load datasets and covert to data frames}

`1` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202101-divvy-tripdata.csv")
View(`1`)
`2` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202102-divvy-tripdata.csv")
View(`2`)
`3` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202103-divvy-tripdata.csv")
View(`3`)
`4` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202004-divvy-tripdata.csv")
View(`4`)
`5` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202005-divvy-tripdata.csv")
View(`5`)
`6` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202006-divvy-tripdata.csv")
View(`6`)
`7` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202007-divvy-tripdata.csv")
View(`7`)
`8` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202008-divvy-tripdata.csv")
View(`8`)
`9` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202009-divvy-tripdata.csv")
View(`9`)
`10` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202010-divvy-tripdata.csv")
View(`10`)
`11` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202011-divvy-tripdata.csv")
View(`11`)
`12` <- read.csv("~/Desktop/Capstone_Project_Data_Analytics/Data_Analytics_Capstone_Project/202012-divvy-tripdata.csv")
View(`12`)
```

###Create combined data frame- combine the (12) separate tables into (1) data frame

```{r, combine into one data frame}
bike_rides <- rbind(`1`,`2`,`3`,`4`,`5`,`6`,`7`,`8`,`9`,`10`,`11`,`12`)
```
###check dimensions of new data frame to verify that data combined successfully

```{r,view combined data frame}
dim(bike_rides)
```   
#### *Result* [1] 3489748      13
 
###remove_empty - check for empty rows/columns:
```{r,check for empty rows/columns}
bike_rides <- janitor::remove_empty(bike_rides, which = c("cols"))
bike_rides <- janitor::remove_empty(bike_rides, which = c("rows"))
####Result:no completely empty rows or columns present
```
 ###*Remove duplicate rows*:
```{r,remove duplicates}
bike_rides2 <- bike_rides[!duplicated(bike_rides$ride_id), ]
print(paste("Removed", nrow(bike_rides) - nrow(bike_rides2), "duplicated rows"))
```
####Result:
[1] "Removed 209 duplicated rows"

###Re-check dimensions:
```{r,data frame dimensions}
dim(bike_rides2)
glimpse(bike_rides2)
```
###*Remove empty* cells(missing station id,ride id,rider type,starting station, ending station, & starting/end lat,long):
```{r,remove empty cells}
na.omit(bike_rides2)
print.function(na.omit(bike_rides2))
```
####Result:
[ reached 'max' / getOption("max.print") -- omitted 3354438 rows ]
 
###*Parsing/date&time*:
```{r,Parsing Date&Time}
bike_rides2$started_at <- as.POSIXct(bike_rides2$started_at, tz = "US/Eastern","%Y-%m-%d %H:%M:%S")
bike_rides2$ended_at <- as.POSIXct(bike_rides2$ended_at, tz = "US/Eastern", "%Y-%m-%d %H:%M:%S")
```
####check columms:
```{r,column check}
str(bike_rides2)

```
###*Format & separate month/year*:
```{r,separate month & year}
bike_rides2 <- bike_rides2 %>%
mutate(year_month = paste(strftime(bike_rides2$started_at, "%Y"), "-", strftime(bike_rides2$started_at, "%m"), paste("(",strftime(bike_rides2$started_at, "%b"), ")", sep = "")))
unique(bike_rides2$year_month)
```
####Result:
[1] "2021 - 01 (Jan)"
 [2] "2020 - 12 (Dec)"
 [3] "2021 - 02 (Feb)"
 [4] "2021 - 03 (Mar)"
 [5] "2020 - 04 (Apr)"
 [6] "2020 - 03 (Mar)"
 [7] "2020 - 05 (May)"
 [8] "2020 - 06 (Jun)"
 [9] "2020 - 07 (Jul)"
[10] "2020 - 08 (Aug)"
[11] "2020 - 09 (Sep)"
[12] "2020 - 10 (Oct)"
[13] "2020 - 11 (Nov)"

###*Check data frame*:

```{r,check}
head(bike_rides2)
```
###*Separate weekdays/weekends*:

```{r,weekdays/weekends}
bike_rides2 <- bike_rides2 %>%
mutate(weekday = paste(strftime(bike_rides2$ended_at, "%u"), "-", strftime(bike_rides2$ended_at, "%a"))) 
unique(bike_rides2$weekday)
```
####Result:
[1] "6 - Sat" "3 - Wed"
[3] "4 - Thu" "1 - Mon"
[5] "7 - Sun" "5 - Fri"
[7] "2 - Tue"

###*Starting Times*:

```{r,start_hour}
bike_rides2 <- bike_rides2 %>% mutate(start_hour = strftime(bike_rides2$ended_at, "%H"))
unique(bike_rides2$start_hour)
```
####Result:
  [1] "16" "18" "22" "13" "02"
 [6] "15" "05" "10" "19" "12"
[11] "07" "09" "08" "11" "01"
[16] "21" "00" "17" "20" "14"
[21] "23" "06" "04" "03"

###*Calculate Ride Time*:
```{r,ride time}
bike_rides2 <- bike_rides2 %>% mutate(ride_time_m = as.numeric(bike_rides2$ended_at - bike_rides2$started_at) / 60)
summary(bike_rides2$ride_time_m)
```
####Summary:
  Min.   1st Qu.    Median 
-29049.97      7.88     14.52 
     Mean   3rd Qu.      Max. 
    26.48     26.63  58720.03 
 
 ###*Correction for Negative Ride lengths*:   

###*Summary*:
```{r,summary check}
summary(bike_rides2)
```
####Result:
    ride_id         
 Length:3354306    
 Class :character  
 Mode  :character  
               
 rideable_type     
 Length:3354306    
 Class :character  
 Mode  :character  
        
   started_at                 
 Min.   :2020-04-01 00:00:30  
 1st Qu.:2020-07-12 20:28:17  
 Median :2020-08-26 18:23:07  
 Mean   :2020-09-08 20:22:58  
 3rd Qu.:2020-10-17 18:56:44  
 Max.   :2021-03-31 23:59:08  
    ended_at                  
 Min.   :2020-04-01 00:10:45  
 1st Qu.:2020-07-12 21:13:10  
 Median :2020-08-26 18:45:42  
 Mean   :2020-09-08 20:49:17  
 3rd Qu.:2020-10-17 19:15:42  
 Max.   :2021-04-06 11:00:11  
 start_station_name
 Length:3354306    
 Class :character  
 Mode  :character  
              
 start_station_id  
 Length:3354306    
 Class :character  
 Mode  :character  
         
 end_station_name  
 Length:3354306    
 Class :character  
 Mode  :character  
               
 end_station_id    
 Length:3354306    
 Class :character  
 Mode  :character  
             
   start_lat    
 Min.   :41.64  
 1st Qu.:41.88  
 Median :41.90  
 Mean   :41.90  
 3rd Qu.:41.93  
 Max.   :42.07  
   start_lng     
 Min.   :-87.78  
 1st Qu.:-87.66  
 Median :-87.64  
 Mean   :-87.64  
 3rd Qu.:-87.63  
 Max.   :-87.53  
    end_lat     
 Min.   :41.54  
 1st Qu.:41.88  
 Median :41.90  
 Mean   :41.91  
 3rd Qu.:41.93  
 Max.   :42.08  
    end_lng      
 Min.   :-88.07  
 1st Qu.:-87.66  
 Median :-87.64  
 Mean   :-87.64  
 3rd Qu.:-87.63  
 Max.   :-87.51  
 member_casual     
 Length:3354306    
 Class :character  
 Mode  :character  
              
      date           
 Min.   :2020-04-01  
 1st Qu.:2020-07-12  
 Median :2020-08-26  
 Mean   :2020-09-08  
 3rd Qu.:2020-10-17  
 Max.   :2021-03-31  
    month          
 Length:3354306    
 Class :character  
 Mode  :character  
           
     day           
 Length:3354306    
 Class :character  
 Mode  :character  
              
     year          
 Length:3354306    
 Class :character  
 Mode  :character  
              
 day_of_week       
 Length:3354306    
 Class :character  
 Mode  :character  
               
  year_month       
 Length:3354306    
 Class :character  
 Mode  :character  
              
   weekday         
 Length:3354306    
 Class :character  
 Mode  :character  
                
  start_hour       
 Length:3354306    
 Class :character  
 Mode  :character  
                 
  ride_time_m       
 Min.   :-29049.97  
 1st Qu.:     7.97  
 Median :    14.62  
 Mean   :    26.32  
 3rd Qu.:    26.72  
 Max.   : 58720.03  
 
###*Correction for negative values in ride time*:
(will use 95% of data to remove outliers that are affecting results and causing negative values)

```{r,correct for negative time values}
ventiles = quantile(bike_rides2$ride_time_m, seq(0, 1, by = 0.05))
ventiles
```
####Result:
Ventiles-
  0%            5% 
-29049.966667      3.166667 
          10%           15% 
     4.583333      5.750000 
          20%           25% 
     6.850000      7.966667 
          30%           35% 
     9.116667     10.333333 
          40%           45% 
    11.616667     13.033333 
          50%           55% 
    14.616667     16.383333 
          60%           65% 
    18.416667     20.750000 
          70%           75% 
    23.500000     26.716667 
          80%           85% 
    30.666667     36.466667 
          90%           95% 
    46.150000     73.250000 
         100% 
 58720.033333 

 ###*Remove the outliers*:
 
``` {r, remove outliers,prep plots}
fig <- function(width,height){options(repr.plot.width = width, repr.plot.height = height)}
bike_rides3 <- bike_rides2 %>% 
filter(ride_time_m > as.numeric(ventiles['5%'])) %>%
filter(ride_time_m < as.numeric(ventiles['95%']))
print(paste("Removed", nrow(bike_rides2) - nrow(bike_rides3), "rows as outliers" ))
```

####Result:
[1] "Removed 350111 rows as outliers"

```{r,check dimensions,save}
dim(bike_rides3)
head(bike_rides3)
bike_rides3%>%
write.csv("bike_rides3.csv")
```
###*Calculations/Analysis*:
```{r,member v casual}
###Calculate the number of casual versus annual members for comparision
bike_rides3 %>% group_by(member_casual) %>% summarise(count = length(ride_id), '%' = (length(ride_id) / nrow(bike_rides3)) * 100)
```
####Result:
A tibble:2 × 3
member_casual
<chr>
count
<int>
%
<dbl>
casual	1228664	39.13656	
member	1910764	60.86344	

```
  {R,group}
bike_rides3 %>% group_by(member_casual) %>% 
summarise(mean = mean(ride_time_m),'first_quarter' = as.numeric(quantile(ride_time_m, .25)), 'median' = median(ride_time_m), 'third_quarter' = as.numeric(quantile(ride_time_m, .75)), 'IR' = third_quarter - first_quarter)
```
####Result:
A tibble:2 × 6
member_casual
<chr>
mean
<dbl>
first_quarter
<dbl>
median
<dbl>
casual	23.67852	11.3	19.16667	
member	15.48345	7.3	12.18333	
2 rows | 1-4 of 6 columns
```{R, group}
bike_rides3 %>% group_by(rideable_type) %>% summarise(count = length(ride_id),'%' = (length(ride_id) / nrow(bike_rides3)) * 100,'members_p' = (sum(member_casual == "member") / length(ride_id)) * 100,'casual_p' = (sum(member_casual == "casual") / length(ride_id)) * 100, 'member_casual_perc_difer' = members_p - casual_p)
```

####Result:
A tibble:3 × 6
rideable_type
<chr>
count
<int>
%
<dbl>
members_p
<dbl>
classic_bike	294441	9.37881	78.26356	
docked_bike	2291710	72.99769	58.74805	
electric_bike	553277	17.62350	60.36560	
  
##*Visualization*
 ##Graph of total rides per day of the week
```
  {R, Weekday Graph}
  bike_rides3 %>%   
group_by(member_casual, weekday) %>% 
summarise(number_of_rides = n() ) %>% 
arrange(member_casual, weekday) %>% 
ggplot(aes(x = weekday, y = number_of_rides, fill = member_casual)) + geom_col(position = "dodge") + 
labs(x= 'Day of Week', y='Total Number of Rides', title='Rides per Day', fill = 'Member vs Casual') +
+ scale_y_continuous(breaks = c(250000, 400000, 550000), labels = c("250K", "400K", "550K"))
```
  ![image](https://user-images.githubusercontent.com/96959280/154780166-29a9f285-d43c-43a3-91f5-870f708a48c3.png)

##Graph of Rides per Month
  bike_rides3 %>%   
  group_by(member_casual, year_month) %>%  
  summarise(total_rides = n(),`ride_time_m` = mean(ride_time_m)) %>% 
  arrange(member_casual) %>% 
  ggplot(aes(x=year_month, y=total_rides, fill = member_casual)) + geom_col(position = "dodge") + 
  labs(x= "Month", y= "Total Number of Rides", title = "Rides per Month", fill = "Member vs Casual") + 
  scale_y_continuous(breaks = c(100000, 200000, 300000, 400000), labels = c("100K", "200K", "300K", "400K")) + theme(axis.text.x = element_text(angle = 45))
